#!/usr/bin/env python3

import numpy
import ne
import os
import tee
import warnings
from sklearn.naive_bayes import GaussianNB
warnings.filterwarnings('ignore')

if __name__ ==  '__main__':
    DATASET  = ne.data.kdd99.dataset
    SELECTOR = ne.data.Pearsons
    THRESH   = lambda x: x > 0.5
    
    log_dir = os.path.join('results', 'feature_selection', SELECTOR.name, DATASET.name())
    os.makedirs(log_dir, exist_ok=True)
    with tee.StdoutTee(os.path.join(log_dir, 'output.log'), buff=1):
        ne.util.dump(__file__)

        results = {}
        for n_features in range(1, DATASET.num_features()):
            split = DATASET.data(selector=SELECTOR(n_features), save=False, cache=True)
            model = GaussianNB(var_smoothing=1e-15)
            model.fit(*split.train)
            stats = ne.stats.compute_statistics(THRESH, split.test.ys, model.predict(split.test.xs))
            results[n_features] = stats
            print("{} - {}".format(n_features, stats.mcc))
        print(list(map(lambda t:t[0], sorted(results.items(), key=lambda t:t[1].mcc, reverse=True))))


1 - 0.9197340809402437
2 - 0.9289118197333434
3 - 0.9287056438716301
4 - 0.9465954265040296
5 - 0.9460434264211581
6 - 0.9396676250157863
7 - 0.947087535825529
8 - 0.9440270562629379
9 - 0.9508646234848864
10 - 0.9536330595809509
11 - 0.952998536729667
12 - 0.9537379254572166
13 - 0.9441063511956175
14 - 0.9443546687853058
15 - 0.9445377018767084
16 - 0.9449129988819703
17 - 0.9456673192884877
18 - 0.9460649218820363
19 - 0.9460163818637555
20 - 0.9458273501416327
21 - 0.9519571944733218
22 - 0.951859101942889
23 - 0.9660677353878483
24 - 0.9642218349458058
25 - 0.9636008366249218
26 - 0.9625566510215791
27 - 0.9581377333397794
28 - 0.9554403246191843
29 - 0.9547565944884855
30 - 0.9547075896176943
31 - 0.9545880927011877
32 - 0.9549266825645765
33 - 0.9541780558536127
34 - 0.9516127769758846
35 - 0.9537166292136003
36 - 0.9536906144904916
37 - 0.9514651593414092
38 - 0.9532493413127243
39 - 0.9532021236178144
40 - 0.9389185688209619
[23, 24, 25, 26, 27, 28, 32, 29, 30, 31, 33, 12, 35, 36, 10, 38, 39, 11, 21, 22, 34, 37, 9, 7, 4, 18, 5, 19, 20, 17, 16, 15, 14, 13, 8, 6, 40, 2, 3, 1]
